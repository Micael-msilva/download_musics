<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Downloader YouTube</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-gray-100 to-gray-300 min-h-screen flex items-center justify-center p-6">
  <div class="max-w-2xl w-full bg-white shadow-2xl rounded-2xl p-8 space-y-8">
    <h1 class="text-3xl font-bold text-center text-blue-700">üéµ YouTube Downloader</h1>

    <!-- Baixar uma m√∫sica -->
    <section class="space-y-3">
      <h2 class="text-xl font-semibold">üîä Baixar m√∫sica √∫nica</h2>
      <input id="url" type="text" placeholder="Cole a URL da m√∫sica" 
             class="w-full border rounded-lg p-3 shadow focus:ring focus:ring-blue-300 outline-none" />
      <select id="format" class="border rounded-lg p-3 shadow w-full">
        <option value="mp3">MP3</option>
        <option value="mp4">MP4</option>
      </select>
      <button onclick="baixarUma()" 
              class="bg-blue-600 hover:bg-blue-700 transition text-white px-4 py-2 rounded-lg w-full shadow">
        üé∂ Baixar
      </button>
      <div id="resultado-uma" class="mt-2 text-sm text-center"></div>
    </section>

    <!-- Baixar lista de m√∫sicas -->
    <section class="space-y-3">
      <h2 class="text-xl font-semibold">üìë Baixar lista de m√∫sicas (JSON)</h2>
      <textarea id="urls-list" placeholder='["url1", "url2"]' 
                class="w-full border rounded-lg p-3 shadow focus:ring focus:ring-green-300 outline-none"></textarea>
      <select id="format-list" class="border rounded-lg p-3 shadow w-full">
        <option value="mp3">MP3</option>
        <option value="mp4">MP4</option>
      </select>
      <button onclick="baixarLista()" 
              class="bg-green-600 hover:bg-green-700 transition text-white px-4 py-2 rounded-lg w-full shadow">
        üì• Baixar Lista
      </button>
      <div id="resultado-lista" class="mt-2 text-sm text-center"></div>
    </section>

    <!-- Baixar de arquivo TXT -->
    <section class="space-y-3">
      <h2 class="text-xl font-semibold">üìÇ Baixar de arquivo TXT</h2>
      <input id="txt-file" type="file" accept=".txt" 
             class="mb-2 w-full border p-2 rounded-lg shadow" />
      <select id="format-txt" class="border rounded-lg p-3 shadow w-full">
        <option value="mp3">MP3</option>
        <option value="mp4">MP4</option>
      </select>
      <button onclick="baixarTxt()" 
              class="bg-purple-600 hover:bg-purple-700 transition text-white px-4 py-2 rounded-lg w-full shadow">
        üì§ Enviar TXT
      </button>
      <div id="resultado-txt" class="mt-2 text-sm text-center"></div>
    </section>
  </div>

  <script>
    const API_URL = "http://127.0.0.1:8000";

    function mostrarStatus(id, mensagem, tipo = "info") {
      const el = document.getElementById(id);
      const cores = {
        info: "text-blue-600",
        sucesso: "text-green-600",
        erro: "text-red-600"
      };
      el.className = `mt-2 text-sm text-center ${cores[tipo]}`;
      el.innerHTML = mensagem;
    }

    async function baixarUma() {
      const url = document.getElementById("url").value;
      const format = document.getElementById("format").value;
      mostrarStatus("resultado-uma", "‚è≥ Baixando m√∫sica...", "info");

      try {
        const res = await fetch(`${API_URL}/baixar-uma/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ url, format })
        });

        if (res.ok) {
          const blob = await res.blob();
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = `musica.${format}`;
          a.click();
          mostrarStatus("resultado-uma", "‚úÖ Download conclu√≠do!", "sucesso");
        } else {
          mostrarStatus("resultado-uma", "‚ùå Falha no download.", "erro");
        }
      } catch (err) {
        mostrarStatus("resultado-uma", "‚ùå Erro de conex√£o.", "erro");
      }
    }

    async function baixarLista() {
      const urls = JSON.parse(document.getElementById("urls-list").value);
      const format = document.getElementById("format-list").value;
      mostrarStatus("resultado-lista", "‚è≥ Baixando lista...", "info");

      try {
        const res = await fetch(`${API_URL}/baixar-lista/`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ urls, format })
        });

        if (res.ok) {
          const blob = await res.blob();
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = `lista.zip`;
          a.click();
          mostrarStatus("resultado-lista", "‚úÖ Download conclu√≠do!", "sucesso");
        } else {
          mostrarStatus("resultado-lista", "‚ùå Falha ao baixar lista.", "erro");
        }
      } catch (err) {
        mostrarStatus("resultado-lista", "‚ùå Erro de conex√£o.", "erro");
      }
    }

    async function baixarTxt() {
      const file = document.getElementById("txt-file").files[0];
      const format = document.getElementById("format-txt").value;
      mostrarStatus("resultado-txt", "‚è≥ Enviando TXT e baixando m√∫sicas...", "info");

      const formData = new FormData();
      formData.append("file", file);
      formData.append("formato", format);

      try {
        const res = await fetch(`${API_URL}/baixar-txt/`, {
          method: "POST",
          body: formData
        });

        if (res.ok) {
          const blob = await res.blob();
          const a = document.createElement("a");
          a.href = URL.createObjectURL(blob);
          a.download = `musicas.zip`;
          a.click();
          mostrarStatus("resultado-txt", "‚úÖ Download conclu√≠do!", "sucesso");
        } else {
          mostrarStatus("resultado-txt", "‚ùå Falha ao processar TXT.", "erro");
        }
      } catch (err) {
        mostrarStatus("resultado-txt", "‚ùå Erro de conex√£o.", "erro");
      }
    }
  </script>
</body>
</html>
